import AOAuth2Application from 'pipes-nodejs-sdk/dist/lib/Authorization/Type/OAuth2/AOAuth2Application';
import { IWebhookApplication } from 'pipes-nodejs-sdk/dist/lib/Application/Base/IWebhookApplication';
import ProcessDto from 'pipes-nodejs-sdk/dist/lib/Utils/ProcessDto';
import { ApplicationInstall } from 'pipes-nodejs-sdk/dist/lib/Application/Database/ApplicationInstall';
import HttpMethods from 'pipes-nodejs-sdk/dist/lib/Transport/HttpMethods';
import RequestDto from 'pipes-nodejs-sdk/dist/lib/Transport/Curl/RequestDto';
import Form from 'pipes-nodejs-sdk/dist/lib/Application/Model/Form/Form';
import WebhookSubscription from 'pipes-nodejs-sdk/dist/lib/Application/Model/Webhook/WebhookSubscription';
import ResponseDto from 'pipes-nodejs-sdk/dist/lib/Transport/Curl/ResponseDto';
import Field from 'pipes-nodejs-sdk/dist/lib/Application/Model/Form/Field';
import FieldType from 'pipes-nodejs-sdk/dist/lib/Application/Model/Form/FieldType';
import { CLIENT_ID, CLIENT_SECRET } from 'pipes-nodejs-sdk/dist/lib/Authorization/Type/OAuth2/IOAuth2Application';
import CurlSender from 'pipes-nodejs-sdk/dist/lib/Transport/Curl/CurlSender';
import { OAuth2Provider } from 'pipes-nodejs-sdk/dist/lib/Authorization/Provider/OAuth2/OAuth2Provider';
import { FORM } from 'pipes-nodejs-sdk/dist/lib/Application/Base/AApplication';
import { CommonHeaders, JSON_TYPE } from 'pipes-nodejs-sdk/dist/lib/Utils/Headers';
import { BodyInit } from 'node-fetch';

export const MAILCHIMP_URL = 'https://login.mailchimp.com/oauth2/authorize';
export const MAILCHIMP_DATACENTER_URL = 'https://login.mailchimp.com';
export const AUDIENCE_ID = 'audience_id';
export const TOKEN_URL = 'https://login.mailchimp.com/oauth2/token';
export const API_KEYPOINT = 'api_keypoint';
export const SEGMENT_ID = 'segment_id';

export default class MailchimpApplication extends AOAuth2Application implements IWebhookApplication {
  constructor(private _sender: CurlSender, private _inputProvider: OAuth2Provider) {
    super(_inputProvider);
  }

  public getDescription = (): string => 'Mailchimp v3';

  public getName = (): string => 'mailchimp';

  public getPublicName = (): string => 'Mailchimp';

  // eslint-disable-next-line max-len
  public getLogo = (): string => 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBBZG9iZSBJbGx1c3RyYXRvciAyNC4yLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIxNTBweCIgaGVpZ2h0PSIxNTBweCIgdmlld0JveD0iMCAwIDE1MCAxNTAiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDE1MCAxNTAiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPGc+DQoJPGc+DQoJCTxnPg0KCQkJPGc+DQoJCQkJPHBhdGggZD0iTTk3LjcsNTQuMjM2YzAuODM4LTAuMSwxLjY0LTAuMTA0LDIuMzc4LDBjMC40MjctMC45NzksMC41LTIuNjY3LDAuMTE2LTQuNTA0Yy0wLjU3LTIuNzMxLTEuMzQzLTQuMzg0LTIuOTM5LTQuMTI3DQoJCQkJCWMtMS41OTYsMC4yNTctMS42NTUsMi4yMzYtMS4wODQsNC45NjhDOTYuNDkyLDUyLjEwOSw5Ny4wNjMsNTMuNDIyLDk3LjcsNTQuMjM2eiIvPg0KCQkJCTxwYXRoIGQ9Ik04My45OTgsNTYuMzk4YzEuMTQyLDAuNTAxLDEuODQ0LDAuODMzLDIuMTE5LDAuNTQzYzAuMTc3LTAuMTgxLDAuMTI0LTAuNTI2LTAuMTQ5LTAuOTcyDQoJCQkJCWMtMC41NjMtMC45Mi0xLjcyMy0xLjg1My0yLjk1My0yLjM3N2MtMi41MTYtMS4wODMtNS41MTUtMC43MjMtNy44MywwLjk0Yy0wLjc2NCwwLjU2LTEuNDg5LDEuMzM1LTEuMzg1LDEuODA2DQoJCQkJCWMwLjAzNCwwLjE1MiwwLjE0OCwwLjI2NywwLjQxNiwwLjMwNGMwLjYzLDAuMDcyLDIuODMxLTEuMDQxLDUuMzY3LTEuMTk2QzgxLjM3Myw1NS4zMzcsODIuODU2LDU1Ljg5Niw4My45OTgsNTYuMzk4eiIvPg0KCQkJCTxwYXRoIGQ9Ik04MS43LDU3LjcwOGMtMS40ODcsMC4yMzUtMi4zMDgsMC43MjUtMi44MzQsMS4xODFjLTAuNDUsMC4zOTMtMC43MjgsMC44MjctMC43MjUsMS4xMzMNCgkJCQkJYzAuMDAxLDAuMTQ1LDAuMDY0LDAuMjI5LDAuMTE0LDAuMjcxYzAuMDY4LDAuMDYsMC4xNDgsMC4wOTMsMC4yNDUsMC4wOTNjMC4zMzYsMCwxLjA4OC0wLjMwMiwxLjA4OC0wLjMwMg0KCQkJCQljMi4wNy0wLjc0MSwzLjQzNS0wLjY1MSw0Ljc4OS0wLjQ5N2MwLjc0OCwwLjA4NCwxLjEwMSwwLjEzLDEuMjY1LTAuMTI2YzAuMDQ4LTAuMDczLDAuMTA3LTAuMjMzLTAuMDQyLTAuNDc2DQoJCQkJCUM4NS4yNTEsNTguNDIsODMuNzQ5LDU3LjQ2NSw4MS43LDU3LjcwOHoiLz4NCgkJCQk8cGF0aCBkPSJNOTMuMDczLDYyLjUyYzEuMDEsMC40OTYsMi4xMjIsMC4zMDIsMi40ODQtMC40MzVjMC4zNjItMC43MzctMC4xNjQtMS43MzYtMS4xNzMtMi4yMzINCgkJCQkJYy0xLjAxLTAuNDk2LTIuMTIyLTAuMzAxLTIuNDg0LDAuNDM1QzkxLjUzOCw2MS4wMjQsOTIuMDYzLDYyLjAyNCw5My4wNzMsNjIuNTJ6Ii8+DQoJCQkJPHBhdGggZD0iTTk5LjU2Niw1Ni44NDdjLTAuODItMC4wMTQtMS41MDEsMC44ODctMS41MiwyLjAxMmMtMC4wMTksMS4xMjUsMC42MzEsMi4wNDgsMS40NTEsMi4wNjINCgkJCQkJYzAuODIsMC4wMTQsMS41MDEtMC44ODcsMS41Mi0yLjAxMkMxMDEuMDM2LDU3Ljc4NCwxMDAuMzg2LDU2Ljg2MSw5OS41NjYsNTYuODQ3eiIvPg0KCQkJCTxwYXRoIGQ9Ik00NC40NTgsNzcuMTM0Yy0wLjIwNC0wLjI1Ni0wLjUzOS0wLjE3OC0wLjg2NC0wLjEwMmMtMC4yMjcsMC4wNTMtMC40ODQsMC4xMTMtMC43NjUsMC4xMDgNCgkJCQkJYy0wLjYwNC0wLjAxMi0xLjExNS0wLjI3LTEuNDAyLTAuNzFjLTAuMzc0LTAuNTc0LTAuMzUyLTEuNDMsMC4wNjEtMi40MDljMC4wNTYtMC4xMzIsMC4xMjEtMC4yNzksMC4xOTItMC40MzkNCgkJCQkJYzAuNjU4LTEuNDc2LDEuNzU5LTMuOTQ3LDAuNTIzLTYuMzAyYy0wLjkzMS0xLjc3Mi0yLjQ0OC0yLjg3Ni00LjI3My0zLjEwN2MtMS43NTItMC4yMjItMy41NTYsMC40MjgtNC43MDYsMS42OTcNCgkJCQkJYy0xLjgxNSwyLjAwMy0yLjA5OSw0LjcyNy0xLjc0OCw1LjY5YzAuMTI5LDAuMzUzLDAuMzMsMC40NSwwLjQ3NiwwLjQ3YzAuMzA5LDAuMDQyLDAuNzY1LTAuMTgzLDEuMDUxLTAuOTUyDQoJCQkJCWMwLjAyMS0wLjA1NiwwLjA0OC0wLjE0MSwwLjA4Mi0wLjI1YzAuMTI3LTAuNDA3LDAuMzY1LTEuMTY0LDAuNzUzLTEuNzcyYzAuNDY5LTAuNzMyLDEuMTk5LTEuMjM3LDIuMDU2LTEuNDINCgkJCQkJYzAuODczLTAuMTg3LDEuNzY1LTAuMDIsMi41MTIsMC40NjljMS4yNzEsMC44MzIsMS43NjEsMi4zOSwxLjIxOCwzLjg3N2MtMC4yODEsMC43NjktMC43MzYsMi4yMzktMC42MzYsMy40NDcNCgkJCQkJYzAuMjAzLDIuNDQ1LDEuNzA3LDMuNDI3LDMuMDU4LDMuNTMxYzEuMzE0LDAuMDUsMi4yMzItMC42ODgsMi40NjQtMS4yMjdDNDQuNjQ4LDc3LjQxMSw0NC41MzMsNzcuMjE3LDQ0LjQ1OCw3Ny4xMzR6Ii8+DQoJCQkJPHBhdGggZD0iTTEyMC4yNjgsNzIuNjYzYy0wLjA1LTAuMTc3LTAuMzc2LTEuMzY3LTAuODIzLTIuODAyYy0wLjQ0OC0xLjQzNS0wLjkxMS0yLjQ0NS0wLjkxMS0yLjQ0NQ0KCQkJCQljMS43OTUtMi42ODcsMS44MjctNS4wOTEsMS41ODktNi40NTJjLTAuMjU1LTEuNjg3LTAuOTU3LTMuMTI1LTIuMzczLTQuNjEyYy0xLjQxNi0xLjQ4Ni00LjMxMS0zLjAwOC04LjM4MS00LjE1MQ0KCQkJCQljLTAuNDY2LTAuMTMxLTItMC41NTItMi4xMzUtMC41OTNjLTAuMDEtMC4wODgtMC4xMTItNS4wMzQtMC4yMDUtNy4xNTdjLTAuMDY3LTEuNTM1LTAuMTk5LTMuOTMxLTAuOTQzLTYuMjkxDQoJCQkJCWMtMC44ODYtMy4xOTQtMi40My01Ljk5LTQuMzU3LTcuNzc4YzUuMzE4LTUuNTEyLDguNjM3LTExLjU4NCw4LjYyOS0xNi43OTRDMTEwLjM0MywzLjU3Miw5OC4wNCwwLjU0LDgyLjg3OSw2LjgxOA0KCQkJCQljLTAuMDE2LDAuMDA3LTMuMTg5LDEuMzUyLTMuMjEyLDEuMzY0Yy0wLjAxNC0wLjAxNC01LjgwNy01LjY5OC01Ljg5NS01Ljc3NEM1Ni40ODYtMTIuNjY5LDIuNDQsNDcuNDA1LDE5LjcxOSw2MS45OTUNCgkJCQkJbDMuNzc2LDMuMTk5Yy0wLjk4LDIuNTM3LTEuMzY0LDUuNDQ1LTEuMDUsOC41NzFjMC40MDQsNC4wMTUsMi40NzUsNy44NjUsNS44MzIsMTAuODM5YzMuMTg3LDIuODIzLDcuMzc3LDQuNjExLDExLjQ0Myw0LjYwNw0KCQkJCQljNi43MjQsMTUuNDk2LDIyLjA4OCwyNS4wMDIsNDAuMTAzLDI1LjUzN2MxOS4zMjQsMC41NzQsMzUuNTQ1LTguNDkzLDQyLjM0Mi0yNC43ODFjMC40NDUtMS4xNDMsMi4zMzEtNi4yOTQsMi4zMzEtMTAuODQNCgkJCQkJQzEyNC40OTYsNzQuNTU2LDEyMS45MTMsNzIuNjYzLDEyMC4yNjgsNzIuNjYzeiBNNDEuMjA2LDg0Ljg1OWMtMC41ODcsMC4xLTEuMTg2LDAuMTQtMS43OSwwLjEyNg0KCQkJCQljLTUuODM2LTAuMTU3LTEyLjE0MS01LjQxMS0xMi43NjctMTEuNjQyYy0wLjY5Mi02Ljg4OCwyLjgyNy0xMi4xODgsOS4wNTgtMTMuNDQ1YzAuNzQ1LTAuMTUsMS42NDUtMC4yMzcsMi42MTYtMC4xODYNCgkJCQkJYzMuNDkxLDAuMTkxLDguNjM2LDIuODcyLDkuODExLDEwLjQ3N0M0OS4xNzUsNzYuOTI0LDQ3LjUyMiw4My43ODIsNDEuMjA2LDg0Ljg1OXogTTM0LjY4OCw1NS43NzcNCgkJCQkJYy0zLjg3OSwwLjc1NC03LjI5OCwyLjk1Mi05LjM4OCw1Ljk4OWMtMS4yNS0xLjA0Mi0zLjU3Ny0zLjA2LTMuOTg5LTMuODQ2Yy0zLjMzOC02LjMzOCwzLjY0My0xOC42Niw4LjUxOS0yNS42MTgNCgkJCQkJQzQxLjg4MSwxNS4xMDUsNjAuNzU1LDIuMDg4LDY5LjQ5Myw0LjQ1YzEuNDIsMC40MDIsNi4xMjUsNS44NTcsNi4xMjUsNS44NTdzLTguNzM0LDQuODQ2LTE2LjgzMywxMS42MDENCgkJCQkJQzQ3Ljg3MSwzMC4zMSwzOS42MjcsNDIuNTI0LDM0LjY4OCw1NS43Nzd6IE05NS45NSw4Mi4yODNjMC4xMjctMC4wNTQsMC4yMTQtMC4xOTksMC4yLTAuMzQzDQoJCQkJCWMtMC4wMTgtMC4xNzctMC4xNzYtMC4zMDYtMC4zNTMtMC4yODhjMCwwLTkuMTQzLDEuMzU0LTE3Ljc4LTEuODA5YzAuOTQxLTMuMDU4LDMuNDQyLTEuOTUzLDcuMjIzLTEuNjQ4DQoJCQkJCWM2LjgxNSwwLjQwNiwxMi45MjMtMC41ODksMTcuNDM3LTEuODg1YzMuOTEyLTEuMTIzLDkuMDQ5LTMuMzM2LDEzLjA0LTYuNDg1YzEuMzQ2LDIuOTU2LDEuODIxLDYuMjEsMS44MjEsNi4yMQ0KCQkJCQlzMS4wNDItMC4xODYsMS45MTMsMC4zNDljMC44MjMsMC41MDYsMS40MjYsMS41NTksMS4wMTQsNC4yOGMtMC44MzksNS4wODQtMyw5LjIxLTYuNjMyLDEzLjAwNg0KCQkJCQljLTIuMjExLDIuMzgtNC44OTUsNC40NDktNy45NjUsNS45NTNjLTEuNjMxLDAuODU3LTMuMzY4LDEuNTk4LTUuMjAyLDIuMTk3Yy0xMy42OTEsNC40NzItMjcuNzA2LTAuNDQ1LTMyLjIyMy0xMS4wMDINCgkJCQkJYy0wLjM2MS0wLjc5NC0wLjY2NS0xLjYyNC0wLjkwNi0yLjQ5M2MtMS45MjUtNi45NTctMC4yOTEtMTUuMzAzLDQuODE4LTIwLjU1N2MwLDAtMC4wMDEtMC4wMDIsMC0wLjAwMw0KCQkJCQljMC4zMTUtMC4zMzUsMC42MzYtMC43MjksMC42MzYtMS4yMjRjMC0wLjQxNS0wLjI2NC0wLjg1Mi0wLjQ5Mi0xLjE2MmMtMS43ODctMi41OTMtNy45NzktNy4wMS02LjczNi0xNS41Ng0KCQkJCQljMC44OTItNi4xNDIsNi4yNjQtMTAuNDY4LDExLjI3Mi0xMC4yMTFjMC40MjMsMC4wMjIsMC44NDcsMC4wNDgsMS4yNjksMC4wNzNjMi4xNywwLjEyOCw0LjA2NCwwLjQwNyw1Ljg1LDAuNDgyDQoJCQkJCWMyLjk5LDAuMTI5LDUuNjc5LTAuMzA2LDguODY0LTIuOTU5YzEuMDc1LTAuODk1LDEuOTM2LTEuNjcxLDMuMzkzLTEuOTE4YzAuMTUzLTAuMDI2LDAuNTM0LTAuMTYzLDEuMjk2LTAuMTI3DQoJCQkJCWMwLjc3NywwLjA0MSwxLjUxOCwwLjI1NSwyLjE4MywwLjY5OGMyLjU1MywxLjY5OSwyLjkxNSw1LjgxNCwzLjA0OCw4LjgyNGMwLjA3NSwxLjcxOCwwLjI4Myw1Ljg3NSwwLjM1NCw3LjA2OQ0KCQkJCQljMC4xNjIsMi43MjksMC44OCwzLjExNCwyLjMzMSwzLjU5MWMwLjgxNiwwLjI2OSwxLjU3NCwwLjQ2OSwyLjY5LDAuNzgyYzMuMzgsMC45NDksNS4zODMsMS45MTIsNi42NDcsMy4xNDgNCgkJCQkJYzAuNzUzLDAuNzczLDEuMTAzLDEuNTk0LDEuMjEyLDIuMzc3YzAuMzk5LDIuOTA3LTIuMjU3LDYuNDk5LTkuMjg3LDkuNzYyYy03LjY4NSwzLjU2Ny0xNy4wMDgsNC40Ny0yMy40NDksMy43NTMNCgkJCQkJYy0wLjQ5NC0wLjA1NS0yLjI1MS0wLjI1NC0yLjI1Ny0wLjI1NWMtNS4xNTMtMC42OTQtOC4wOTIsNS45NjUtNC45OTksMTAuNTI3YzEuOTkzLDIuOTQsNy40MjEsNC44NTQsMTIuODUzLDQuODU1DQoJCQkJCWMxMi40NTMsMC4wMDIsMjIuMDI1LTUuMzE2LDI1LjU4NS05LjkwOWMwLjEwNy0wLjEzNywwLjExNy0wLjE1MiwwLjI4NS0wLjQwNmMwLjE3NS0wLjI2NCwwLjAzMS0wLjQwOS0wLjE4OC0wLjI2DQoJCQkJCWMtMi45MDksMS45OS0xNS44Myw5Ljg5Mi0yOS42NSw3LjUxNWMwLDAtMS42NzktMC4yNzYtMy4yMTItMC44NzNjLTEuMjE4LTAuNDc0LTMuNzY4LTEuNjQ3LTQuMDc4LTQuMjYzDQoJCQkJCUM4OC45MjgsODUuNTQ0LDk1Ljk1LDgyLjI4Myw5NS45NSw4Mi4yODN6IE03OC4yODMsODAuMTk4YzAsMC4wMDEsMC4wMDEsMC4wMDIsMC4wMDEsMC4wMDMNCgkJCQkJYzAuMDAxLDAuMDAyLDAuMDAxLDAuMDA0LDAuMDAyLDAuMDA2Qzc4LjI4NSw4MC4yMDMsNzguMjg0LDgwLjIsNzguMjgzLDgwLjE5OHogTTU2Ljk0NSwzMi4yMzINCgkJCQkJYzQuMjg0LTQuOTUxLDkuNTU4LTkuMjU1LDE0LjI4My0xMS42NzJjMC4xNjMtMC4wODQsMC4zMzcsMC4wOTQsMC4yNDgsMC4yNTRjLTAuMzc1LDAuNjc5LTEuMDk3LDIuMTM0LTEuMzI2LDMuMjM3DQoJCQkJCWMtMC4wMzYsMC4xNzIsMC4xNTIsMC4zMDEsMC4yOTcsMC4yMDJjMi45MzktMi4wMDQsOC4wNTItNC4xNSwxMi41MzctNC40MjZjMC4xOTMtMC4wMTIsMC4yODYsMC4yMzUsMC4xMzMsMC4zNTMNCgkJCQkJYy0wLjY4MiwwLjUyMy0xLjQyOCwxLjI0Ny0xLjk3MywxLjk3OWMtMC4wOTMsMC4xMjUtMC4wMDYsMC4zMDQsMC4xNSwwLjMwNWMzLjE0OSwwLjAyMiw3LjU4OSwxLjEyNCwxMC40ODIsMi43NDcNCgkJCQkJYzAuMTk2LDAuMTEsMC4wNTYsMC40ODktMC4xNjMsMC40MzljLTQuMzc4LTEuMDA0LTExLjU0NC0xLjc2NS0xOC45ODgsMC4wNTFjLTYuNjQ2LDEuNjIxLTExLjcxOCw0LjEyNC0xNS40MTgsNi44MTUNCgkJCQkJQzU3LjAxOSwzMi42NTQsNTYuNzk0LDMyLjQwNyw1Ni45NDUsMzIuMjMyeiIvPg0KCQkJPC9nPg0KCQk8L2c+DQoJPC9nPg0KCTxnPg0KCQk8cGF0aCBkPSJNMzIuMjIxLDEzMi42OTVjLTIuMTI3LDAtMy4xNzksMS42NzQtMy42NjIsMi43NTNjLTAuMjcsMC42MDMtMC4zNDUsMS4wNzktMC41NjQsMS4wNzljLTAuMzA4LDAtMC4wODctMC40MTQtMC4zNC0xLjMzMw0KCQkJYy0wLjMzMi0xLjIwOS0xLjMzMi0yLjUtMy40NTgtMi41Yy0yLjIzNSwwLTMuMTkxLDEuODg4LTMuNjQ1LDIuOTI1Yy0wLjMxLDAuNzA5LTAuMzExLDAuOTA3LTAuNTQ5LDAuOTA3DQoJCQljLTAuMzQ2LDAtMC4wNTktMC41NjMsMC4wOTYtMS4yMjZjMC4zMDYtMS4zMDQsMC4wNzMtMi4zMDEsMC4wNzMtMi4zMDFoLTMuNTQydjEzLjMyaDQuODM1YzAsMCwwLTUuNTY3LDAtNi42MjcNCgkJCWMwLTEuMzA3LDAuNTQ3LTIuOTY2LDEuNDg0LTIuOTY2YzEuMDgzLDAsMS4zLDAuODMyLDEuMywyLjM3MmMwLDEuMzk2LDAsNy4yMjQsMCw3LjIyNGg0Ljg1NWMwLDAsMC01LjYsMC02LjYzDQoJCQljMC0xLjE2NCwwLjQ3NS0yLjk2NiwxLjQ5MS0yLjk2NmMxLjA5OCwwLDEuMjkyLDEuMTY4LDEuMjkyLDIuMzcyczAsNy4yMjEsMCw3LjIyMWg0Ljc2N2MwLDAsMC01LjI3OCwwLTcuODMzDQoJCQlDMzYuNjU1LDEzNS4wMTIsMzUuNDMsMTMyLjY5NSwzMi4yMjEsMTMyLjY5NXoiLz4NCgkJPHBhdGggZD0iTTExNC4yODksMTMyLjY5NWMtMi4xMjcsMC0zLjE3OSwxLjY3NC0zLjY2MiwyLjc1M2MtMC4yNywwLjYwMy0wLjM0NSwxLjA3OS0wLjU2NCwxLjA3OWMtMC4zMDgsMC0wLjEwMi0wLjUyNi0wLjM0LTEuMzMzDQoJCQljLTAuMzU0LTEuMjAyLTEuMjM2LTIuNS0zLjQ1OC0yLjVjLTIuMjM1LDAtMy4xOTEsMS44ODgtMy42NDUsMi45MjVjLTAuMzEsMC43MDktMC4zMTEsMC45MDctMC41NDksMC45MDcNCgkJCWMtMC4zNDYsMC0wLjA1OS0wLjU2MywwLjA5Ni0xLjIyNmMwLjMwNi0xLjMwNCwwLjA3My0yLjMwMSwwLjA3My0yLjMwMWgtMy41NDJ2MTMuMzJoNC44MzVjMCwwLDAtNS41NjcsMC02LjYyNw0KCQkJYzAtMS4zMDcsMC41NDctMi45NjYsMS40ODQtMi45NjZjMS4wODMsMCwxLjMsMC44MzIsMS4zLDIuMzcyYzAsMS4zOTYsMCw3LjIyNCwwLDcuMjI0aDQuODU1YzAsMCwwLTUuNiwwLTYuNjMNCgkJCWMwLTEuMTY0LDAuNDc1LTIuOTY2LDEuNDkxLTIuOTY2YzEuMDk4LDAsMS4yOTIsMS4xNjgsMS4yOTIsMi4zNzJzMCw3LjIyMSwwLDcuMjIxaDQuNzY3YzAsMCwwLTUuMjc4LDAtNy44MzMNCgkJCUMxMTguNzI0LDEzNS4wMTIsMTE3LjQ5OCwxMzIuNjk1LDExNC4yODksMTMyLjY5NXoiLz4NCgkJPHBhdGggZD0iTTQ0LjkxMSwxMzIuNjk4Yy0zLjcwNCwwLTYuMzYxLDEuMzYyLTYuMzYxLDEuMzYydjQuMDAzYzAsMCwyLjkzNS0xLjY4Nyw1LjMxNi0xLjY4N2MxLjksMCwyLjEzNCwxLjAyNSwyLjA0NywxLjg3Ng0KCQkJYzAsMC0wLjU0OC0wLjE0NS0yLjIyMS0wLjE0NWMtMy45NDEsMC01LjkzLDEuNzkxLTUuOTMsNC42NjNjMCwyLjcyNCwyLjIzNiwzLjg2Myw0LjExOSwzLjg2M2MyLjc0OSwwLDMuOTU3LTEuODQ3LDQuMzI4LTIuNzIzDQoJCQljMC4yNTgtMC42MDgsMC4zMDUtMS4wMTgsMC41MzYtMS4wMThjMC4yNjQsMCwwLjE3NSwwLjI5NCwwLjE2MiwwLjg5OWMtMC4wMjIsMS4wNiwwLjAyOCwxLjg2MSwwLjE5NiwyLjUzNWgzLjY0NHYtNi41NTUNCgkJCUM1MC43NDgsMTM1LjY3Niw0OS4zLDEzMi42OTgsNDQuOTExLDEzMi42OTh6IE00My43MzQsMTQzLjIwOGMtMS4xNTYsMC4yNjctMS43NTUtMC4wODktMS43NTUtMC44NTYNCgkJCWMwLTEuMDUsMS4wODYtMS40NywyLjYzNi0xLjQ3YzAuNjgzLDAsMS4zMjYsMC4wNTksMS4zMjYsMC4wNTlDNDUuOTQsMTQxLjM5MSw0NC45NjQsMTQyLjkyNCw0My43MzQsMTQzLjIwOHoiLz4NCgkJPHJlY3QgeD0iNTguNzEyIiB5PSIxMjguOTY5IiB3aWR0aD0iNC44MzUiIGhlaWdodD0iMTcuMzU1Ii8+DQoJCTxwYXRoIGQ9Ik02OC44NywxMzkuNjY0YzAtMS4xOTgsMS4xMTMtMi4yODcsMy4xNTUtMi4yODdjMi4yMjYsMCw0LjAxNiwxLjA3Miw0LjQxNywxLjMxNXYtNC42MzNjMCwwLTEuNDE0LTEuMzYyLTQuODktMS4zNjINCgkJCWMtMy42NjQsMC02LjcxNiwyLjE0NC02LjcxNiw2Ljc1OWMwLDQuNjE1LDIuNzY5LDcuMTc0LDYuNzA2LDcuMTc0YzMuMDc1LDAsNC45MDgtMS42ODksNC45MDgtMS42ODl2LTQuNA0KCQkJYy0wLjU4LDAuMzI1LTIuMTk2LDEuNDQ2LTQuNDAzLDEuNDQ2QzY5LjcxLDE0MS45ODcsNjguODcsMTQwLjkxMiw2OC44NywxMzkuNjY0eiIvPg0KCQk8cGF0aCBkPSJNODYuMjM3LDEzMi42OThjLTIuNzk5LDAtMy44NjQsMi42NTMtNC4wNzksMy4xMTNjLTAuMjE1LDAuNDYtMC4zMjEsMC43MjYtMC40OTcsMC43Mg0KCQkJYy0wLjMwNi0wLjAxLTAuMDkzLTAuNTY1LDAuMDI3LTAuOTI1YzAuMjI1LTAuNjc5LDAuNzAyLTIuNDYyLDAuNzAyLTQuNjUzYzAtMS40ODYtMC4yMDEtMS45ODMtMC4yMDEtMS45ODNoLTQuMTc0djE3LjM1NWg0LjgzNQ0KCQkJYzAsMCwwLTUuNTQ4LDAtNi42MjdzMC40MzEtMi45NjYsMS42NDktMi45NjZjMS4wMDksMCwxLjMyNSwwLjc0OCwxLjMyNSwyLjI1M2MwLDEuNTA1LDAsNy4zNCwwLDcuMzRoNC44MzVjMCwwLDAtNC4wNiwwLTcuMDUNCgkJCUM5MC42NTksMTM1Ljg1NSw5MC4wOTIsMTMyLjY5OCw4Ni4yMzcsMTMyLjY5OHoiLz4NCgkJPHBhdGggZD0iTTkyLjIzLDEzMy4wMnYxMy4zMDVoNC44MzVWMTMzLjAyYzAsMC0wLjgxMywwLjQ3NS0yLjQxMywwLjQ3NUM5My4wNTMsMTMzLjQ5NSw5Mi4yMywxMzMuMDIsOTIuMjMsMTMzLjAyeiIvPg0KCQk8ZWxsaXBzZSBjeD0iOTQuNjMzIiBjeT0iMTMwLjc2NiIgcng9IjIuOTYiIHJ5PSIxLjkzMiIvPg0KCQk8cGF0aCBkPSJNNTIuMzEzLDEzMy4wMnYxMy4zMDVoNC44MzVWMTMzLjAyYzAsMC0wLjgxMywwLjQ3NS0yLjQxMywwLjQ3NUM1My4xMzUsMTMzLjQ5NSw1Mi4zMTMsMTMzLjAyLDUyLjMxMywxMzMuMDJ6Ii8+DQoJCTxlbGxpcHNlIGN4PSI1NC43MTYiIGN5PSIxMzAuNzY2IiByeD0iMi45NiIgcnk9IjEuOTMyIi8+DQoJCTxwYXRoIGQ9Ik0xMjguMzMsMTMyLjY5NWMtMi40ODYsMC0zLjYyNSwxLjg2NC00LjEyLDIuOTI1Yy0wLjMyNywwLjcwMi0wLjMxMSwwLjkwNy0wLjU0OSwwLjkwN2MtMC4zNDYsMC0wLjA1OS0wLjU2MywwLjA5Ni0xLjIyNg0KCQkJYzAuMzA2LTEuMzA0LDAuMDczLTIuMzAxLDAuMDczLTIuMzAxaC0zLjU0MlYxNTBoNC44MzVjMCwwLDAtMi43ODIsMC01LjM4OWMwLjU3MiwwLjk3MSwxLjYzMiwyLjAwOCwzLjI2NiwyLjAwOA0KCQkJYzMuNDk2LDAsNS4yNTYtMi45NTgsNS4yNTYtNi45NTVDMTMzLjY0NSwxMzUuMTMzLDEzMS41MzksMTMyLjY5NSwxMjguMzMsMTMyLjY5NXogTTEyNy4wMDMsMTQzLjQ2Mg0KCQkJYy0xLjEwOSwwLTEuOTI1LTEuNDA2LTEuOTI1LTMuMzY2YzAtMS45MDMsMC44MzgtMy4zNjUsMS44ODYtMy4zNjVjMS4zNDYsMCwxLjkxOSwxLjIzNCwxLjkxOSwzLjM2NQ0KCQkJQzEyOC44ODQsMTQyLjMxMywxMjguMzU1LDE0My40NjIsMTI3LjAwMywxNDMuNDYyeiIvPg0KCTwvZz4NCjwvZz4NCjwvc3ZnPg0K';

  public getRequestDto(
    dto: ProcessDto,
    applicationInstall: ApplicationInstall,
    method: HttpMethods,
    url?: string,
    data?: BodyInit,
  ): RequestDto {
    const request = new RequestDto(this.getUri(url)
      .toString(), method);
    request.headers = {
      [CommonHeaders.CONTENT_TYPE]: JSON_TYPE,
      [CommonHeaders.ACCEPT]: JSON_TYPE,
      [CommonHeaders.AUTHORIZATION]: `OAuth ${this.getAccessToken(applicationInstall)}`,
    };

    if (data) {
      request.body = data;
    }

    return request;
  }

  // eslint-disable-next-line @typescript-eslint/no-unused-vars
  public getScopes = (applicationInstall: ApplicationInstall): string[] => [];

  public getSettingsForm = (): Form => new Form()
    .addField(new Field(FieldType.TEXT, CLIENT_ID, 'Client Id', undefined, true))
    .addField(new Field(FieldType.TEXT, CLIENT_SECRET, 'Client Secret', undefined, true))
    .addField(new Field(FieldType.TEXT, AUDIENCE_ID, 'Audience Id', undefined, true));

  public getAuthUrl = (): string => MAILCHIMP_URL;

  public getTokenUrl = (): string => TOKEN_URL;

  public getWebhookSubscriptions = (): WebhookSubscription[] => [
    new WebhookSubscription('Create User', 'starting-point', '', { name: 'subscribe' }),
    new WebhookSubscription('Update User', 'starting-point', '', { name: 'upemail' }),
    new WebhookSubscription('Delete User', 'starting-point', '', { name: 'unsubscribe' }),
  ];

  public getWebhookSubscribeRequestDto = (
    applicationInstall: ApplicationInstall,
    subscription: WebhookSubscription,
    url: string,
  ): RequestDto => this.getRequestDto(
    new ProcessDto(),
    applicationInstall,
    HttpMethods.POST,
    `${applicationInstall.getSettings()[API_KEYPOINT]}
    /3.0/lists/${applicationInstall.getSettings()[FORM][AUDIENCE_ID]}/webhooks`,
    JSON.stringify(
      {
        url,
        events: {
          [subscription.getParameters().name]: true,
        },
        sources:
          {
            user: true,
            admin: true,
            api: true,
          },
      },
    ),
  );

  public getWebhookUnsubscribeRequestDto = (
    applicationInstall: ApplicationInstall,
    id: string,
  ): RequestDto => this.getRequestDto(
    new ProcessDto(),
    applicationInstall,
    HttpMethods.DELETE,
    // eslint-disable-next-line max-len
    `${applicationInstall.getSettings()[API_KEYPOINT]}/3.0/lists/${applicationInstall.getSettings()[FORM][AUDIENCE_ID]}/webhooks/${id}`,
  );

  public processWebhookSubscribeResponse = (
    dto: ResponseDto,
    // eslint-disable-next-line @typescript-eslint/no-unused-vars
    applicationInstall: ApplicationInstall,
  ): string => JSON.parse(dto.body).id;

  public processWebhookUnsubscribeResponse = (dto: ResponseDto): boolean => dto.responseCode === 204;

  public async getApiEndpoint(applicationInstall: ApplicationInstall): Promise<string> {
    const output = await this._sender.send(
      this.getRequestDto(
        new ProcessDto(),
        applicationInstall,
        HttpMethods.GET,
        '%s/oauth2/metadata',
        MAILCHIMP_DATACENTER_URL,
      ),
    );

    // eslint-disable-next-line @typescript-eslint/naming-convention
    return output.jsonBody as { api_endpoint: string }['api_endpoint'] ?? '';
  }
}
