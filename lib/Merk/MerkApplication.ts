import { AUTHORIZATION_FORM } from '@orchesty/nodejs-sdk/dist/lib/Application/Base/AApplication';
import { ApplicationInstall } from '@orchesty/nodejs-sdk/dist/lib/Application/Database/ApplicationInstall';
import Field from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/Field';
import FieldType from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/FieldType';
import Form from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/Form';
import FormStack from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/FormStack';
import { ABasicApplication } from '@orchesty/nodejs-sdk/dist/lib/Authorization/Type/Basic/ABasicApplication';
import RequestDto from '@orchesty/nodejs-sdk/dist/lib/Transport/Curl/RequestDto';
import { HttpMethods } from '@orchesty/nodejs-sdk/dist/lib/Transport/HttpMethods';
import AProcessDto from '@orchesty/nodejs-sdk/dist/lib/Utils/AProcessDto';
import { CommonHeaders, JSON_TYPE } from '@orchesty/nodejs-sdk/dist/lib/Utils/Headers';

export const NAME = 'merk';
export const API_KEY = 'api_key';

export default class MerkApplication extends ABasicApplication {

    public getName(): string {
        return NAME;
    }

    public getPublicName(): string {
        return 'Merk';
    }

    public getDescription(): string {
        return 'Company database and marketing tool that helps users to improve their business as well as find new opportunities';
    }

    public getLogo(): string {
        return 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI1LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IlZyc3R2YV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAwIDEwMDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtjbGlwLXBhdGg6dXJsKCNTVkdJRF8yXyk7ZmlsbDp1cmwoI1NWR0lEXzNfKTt9Cgkuc3Qxe2NsaXAtcGF0aDp1cmwoI1NWR0lEXzVfKTtmaWxsOnVybCgjU1ZHSURfNl8pO30KCS5zdDJ7Y2xpcC1wYXRoOnVybCgjU1ZHSURfOF8pO2ZpbGw6dXJsKCNTVkdJRF85Xyk7fQoJLnN0M3tjbGlwLXBhdGg6dXJsKCNTVkdJRF8xMV8pO2ZpbGw6dXJsKCNTVkdJRF8xMl8pO30KCS5zdDR7ZmlsbDojMTNDREYwO30KCS5zdDV7ZmlsbDojMENBOERFO30KPC9zdHlsZT4KPGc+Cgk8Zz4KCQk8ZGVmcz4KCQkJPHBhdGggaWQ9IlNWR0lEXzFfIiBkPSJNNTkuOSw0My44Yy0wLjYsMC4yLTEuMiwwLjUtMS42LDAuOGMtMC41LTAuNS0xLjItMC44LTEuOC0wLjljLTAuNy0wLjItMS40LTAuMi0yLjEtMC4yCgkJCQljLTEuMywwLjEtMi41LDAuNC0zLjYsMS4xYy0xLjEsMC43LTEuNiwyLjEtMS42LDQuMlY1NmgzLjJ2LTcuOGMwLTAuNywwLjItMS4zLDAuNi0xLjZjMC40LTAuMywwLjktMC41LDEuNS0wLjUKCQkJCWMwLjYsMCwxLDAuMiwxLjUsMC41YzAuNCwwLjMsMC43LDAuOSwwLjcsMS42VjU2aDMuMnYtNy44YzAtMC43LDAuMi0xLjMsMC43LTEuNmMwLjQtMC4zLDAuOS0wLjUsMS41LTAuNWMwLjUsMCwxLDAuMiwxLjUsMC41CgkJCQljMC40LDAuMywwLjcsMC45LDAuNywxLjZ2Ni4yYzAsMC41LDAuMSwwLjgsMC40LDEuMWMwLjMsMC4zLDAuNywwLjQsMS4xLDAuNGgxLjZ2LTcuMWMwLTIuMS0wLjYtMy42LTEuNy00LjMKCQkJCWMtMS4xLTAuNy0yLjQtMS4xLTMuNy0xLjFDNjEuMiw0My41LDYwLjUsNDMuNiw1OS45LDQzLjgiLz4KCQk8L2RlZnM+CgkJPGNsaXBQYXRoIGlkPSJTVkdJRF8yXyI+CgkJCTx1c2UgeGxpbms6aHJlZj0iI1NWR0lEXzFfIiAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7Ii8+CgkJPC9jbGlwUGF0aD4KCQkKCQkJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8zXyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI1OC4xOTc1IiB5MT0iNTYuMjI2OSIgeDI9IjU4LjE5NzUiIHkyPSI0My43MDgxIiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDEgMCAwIC0xIDAgOTkuODg5OCkiPgoJCQk8c3RvcCAgb2Zmc2V0PSIwIiBzdHlsZT0ic3RvcC1jb2xvcjojNzc3ODdCIi8+CgkJCTxzdG9wICBvZmZzZXQ9IjEiIHN0eWxlPSJzdG9wLWNvbG9yOiM2MzY0NjYiLz4KCQk8L2xpbmVhckdyYWRpZW50PgoJCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik00OS4xLDQzLjVoMTguMVY1Nkg0OS4xTDQ5LjEsNDMuNXoiLz4KCTwvZz4KCTxnPgoJCTxkZWZzPgoJCQk8cGF0aCBpZD0iU1ZHSURfNF8iIGQ9Ik03Mi40LDQ2LjhjMC40LTAuNCwxLTAuNiwxLjYtMC42YzAuNywwLDEuMywwLjIsMS43LDAuNmMwLjQsMC40LDAuNiwxLDAuNiwxLjhoLTQuNwoJCQkJQzcxLjcsNDcuOCw3Miw0Ny4yLDcyLjQsNDYuOCBNNjkuOSw0NS4yYy0wLjksMS4xLTEuNCwyLjYtMS40LDQuNmMwLDIsMC41LDMuNiwxLjUsNC43YzEsMS4xLDIuMywxLjcsNC4xLDEuNwoJCQkJYzEuNCwwLDIuNi0wLjQsMy42LTEuMWMwLjktMC43LDEuNi0xLjYsMS45LTIuOWgtMi4zYy0wLjQsMC0wLjcsMC4xLTAuOCwwLjJjLTAuMiwwLjItMC4zLDAuMy0wLjMsMC40Yy0wLjEsMC4xLTAuMiwwLjItMC4zLDAuMwoJCQkJYy0wLjEsMC4xLTAuMiwwLjEtMC4zLDAuMmMtMC40LDAuMi0wLjgsMC4zLTEuMywwLjNjLTAuOCwwLTEuNC0wLjItMS44LTAuN2MtMC40LTAuNS0wLjctMS4yLTAuNy0yLjFoNy45YzAtMC4xLDAtMC4yLDAtMC4zCgkJCQl2LTAuNWMwLTItMC41LTMuNi0xLjUtNC43Yy0xLTEuMS0yLjQtMS42LTQuMy0xLjZDNzIuMiw0My41LDcwLjgsNDQuMSw2OS45LDQ1LjIiLz4KCQk8L2RlZnM+CgkJPGNsaXBQYXRoIGlkPSJTVkdJRF81XyI+CgkJCTx1c2UgeGxpbms6aHJlZj0iI1NWR0lEXzRfIiAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7Ii8+CgkJPC9jbGlwUGF0aD4KCQkKCQkJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF82XyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI3NC4wNTQ3IiB5MT0iNTYuNDM0IiB4Mj0iNzQuMDU0NyIgeTI9IjQzLjY4NzIiIGdyYWRpZW50VHJhbnNmb3JtPSJtYXRyaXgoMSAwIDAgLTEgMCA5OS44ODk4KSI+CgkJCTxzdG9wICBvZmZzZXQ9IjAiIHN0eWxlPSJzdG9wLWNvbG9yOiM3Nzc4N0IiLz4KCQkJPHN0b3AgIG9mZnNldD0iMSIgc3R5bGU9InN0b3AtY29sb3I6IzYzNjQ2NiIvPgoJCTwvbGluZWFyR3JhZGllbnQ+CgkJPHBhdGggY2xhc3M9InN0MSIgZD0iTTY4LjQsNDMuNWgxMS4ydjEyLjdINjguNFY0My41eiIvPgoJPC9nPgoJPGc+CgkJPGRlZnM+CgkJCTxwYXRoIGlkPSJTVkdJRF83XyIgZD0iTTg3LjYsNDMuOGgtMC4yYy0wLjgsMC0xLjYsMC4xLTIuNCwwLjNjLTAuOCwwLjItMS41LDAuNi0yLDFjLTAuNiwwLjUtMS4xLDEuMS0xLjQsMS45CgkJCQljLTAuNCwwLjgtMC41LDEuOC0wLjUsM1Y1NmgzLjJ2LTYuM2MwLTAuOSwwLjItMS42LDAuNi0yYzAuNC0wLjQsMS4xLTAuNiwyLTAuNmgxLjF2LTMuM0w4Ny42LDQzLjgiLz4KCQk8L2RlZnM+CgkJPGNsaXBQYXRoIGlkPSJTVkdJRF84XyI+CgkJCTx1c2UgeGxpbms6aHJlZj0iI1NWR0lEXzdfIiAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7Ii8+CgkJPC9jbGlwUGF0aD4KCQkKCQkJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF85XyIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI4NC40MDQyIiB5MT0iNTUuODcwOCIgeDI9Ijg0LjQwNDIiIHkyPSI0My42MyIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDk5Ljg4OTgpIj4KCQkJPHN0b3AgIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6Izc3Nzg3QiIvPgoJCQk8c3RvcCAgb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojNjM2NDY2Ii8+CgkJPC9saW5lYXJHcmFkaWVudD4KCQk8cGF0aCBjbGFzcz0ic3QyIiBkPSJNODEsNDMuOGg2LjlWNTZIODFWNDMuOHoiLz4KCTwvZz4KCTxnPgoJCTxkZWZzPgoJCQk8cGF0aCBpZD0iU1ZHSURfMTBfIiBkPSJNODksNDAuMlY1NmgzLjJ2LTQuNmMwLTAuMiwwLjItMC40LDAuNS0wLjVjMC4zLTAuMSwwLjcsMC4yLDEuMiwxLjFsMi4yLDQuMWgzLjlsLTQuNC03LjVsNC40LTQuN2gtMy44CgkJCQlsLTMuOSw0LjV2LTYuNWMwLTAuNC0wLjItMC43LTAuNS0xLjFjLTAuMy0wLjMtMC43LTAuNS0xLjEtMC41SDg5TDg5LDQwLjJ6Ii8+CgkJPC9kZWZzPgoJCTxjbGlwUGF0aCBpZD0iU1ZHSURfMTFfIj4KCQkJPHVzZSB4bGluazpocmVmPSIjU1ZHSURfMTBfIiAgc3R5bGU9Im92ZXJmbG93OnZpc2libGU7Ii8+CgkJPC9jbGlwUGF0aD4KCQkKCQkJPGxpbmVhckdyYWRpZW50IGlkPSJTVkdJRF8xMl8iIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiB4MT0iOTQuNDYxMiIgeTE9IjYwLjA1MDQiIHgyPSI5NC40NjEyIiB5Mj0iNDQuMjE3NyIgZ3JhZGllbnRUcmFuc2Zvcm09Im1hdHJpeCgxIDAgMCAtMSAwIDk5Ljg4OTgpIj4KCQkJPHN0b3AgIG9mZnNldD0iMCIgc3R5bGU9InN0b3AtY29sb3I6Izc3Nzg3QiIvPgoJCQk8c3RvcCAgb2Zmc2V0PSIxIiBzdHlsZT0ic3RvcC1jb2xvcjojNjM2NDY2Ii8+CgkJPC9saW5lYXJHcmFkaWVudD4KCQk8cGF0aCBjbGFzcz0ic3QzIiBkPSJNODksNDAuMmgxMVY1Nkg4OVY0MC4yeiIvPgoJPC9nPgoJPHBhdGggY2xhc3M9InN0NCIgZD0iTTQ1LjYsNDkuN2MtMC41LTcuNy03LTEzLjYtMTQuNy0xMy42Yy0wLjIsMC0wLjMsMC0wLjUsMGMwLjUsMC42LDAuOSwxLjIsMS4yLDEuOWM2LjQsMC4zLDExLjYsNS41LDEyLjEsMTEuOQoJCWMwLjUsNy00LjgsMTMuMi0xMS45LDEzLjdjLTAuMywwLTAuNiwwLTAuOSwwYy02LjIsMC0xMS41LTQuNC0xMi42LTEwLjZjMC4zLTAuOCwwLjQtMS42LDAuNC0yLjVjMC00LjEtMy40LTcuNS03LjUtNy41CgkJYy00LjEsMC03LjQsMy4zLTcuNSw3LjRsMCwwLjVoMi42bDAtMC41YzAtMi43LDIuMi00LjksNC45LTQuOWMyLjcsMCw0LjksMi4yLDQuOSw0LjljMCwyLjctMi4yLDQuOS00LjksNC45aC0wLjFsLTAuNSwwVjU4bDAuNSwwCgkJbDAuMSwwYzIuMiwwLDQuMy0xLDUuNy0yLjdjMiw2LDcuNiwxMC4xLDE0LDEwLjFjMC40LDAsMC43LDAsMS4xLDBjMy45LTAuMyw3LjUtMi4xLDEwLjEtNUM0NC43LDU3LjQsNDUuOSw1My42LDQ1LjYsNDkuNyIvPgoJPGc+CgkJPHBhdGggY2xhc3M9InN0NSIgZD0iTTMyLjMsMzkuN2MwLjIsMC44LDAuMywxLjcsMC4zLDIuNnYwYzQsMC44LDYuOSw0LjMsNi45LDguNGMwLDQuNy0zLjksOC42LTguNiw4LjZjLTQuOCwwLTguNi0zLjgtOC42LTguNgoJCQljMC0wLjEsMC0wLjEsMC0wLjJoMGMwLTYuMi01LTExLjItMTEuMi0xMS4yYy0yLjYsMC00LjksMC45LTYuOCwyLjNsMCwwYy00LjksMy43LTUuOCwxMC43LTIuMSwxNS42YzMuNiw0LjcsMTAuMyw1LjgsMTUuMiwyLjQKCQkJYy0wLjUtMC43LTAuOS0xLjUtMS4yLTIuM2MtMy44LDIuOC05LjEsMi4xLTEyLTEuNmMtMS4yLTEuNi0xLjgtMy40LTEuOC01LjNoMGMwLTQuNywzLjktOC41LDguNi04LjVjNC44LDAsOC42LDMuOCw4LjYsOC42aDAKCQkJYzAsMC4xLDAsMC4xLDAsMC4yYzAsNi4yLDUsMTEuMiwxMS4yLDExLjJjNi4yLDAsMTEuMi01LDExLjItMTEuMkM0Mi4xLDQ1LDM3LjgsNDAuMywzMi4zLDM5LjciLz4KCQk8cGF0aCBjbGFzcz0ic3Q1IiBkPSJNMTcuMSw0MGMwLjktMi4yLDMtMy43LDUuNS0zLjdjMy4zLDAsNiwyLjcsNiw2YzAsMy4xLTIuNCw1LjctNS41LDUuOWMwLjEsMC40LDAuMSwwLjcsMC4xLDEuMQoJCQljMCwwLjIsMCwwLjQsMC4xLDAuN2MzLjktMC40LDctMy43LDctNy43YzAtNC4zLTMuNS03LjctNy44LTcuN2MtMy4yLDAtNS45LDEuOS03LjEsNC43QzE2LjEsMzkuNSwxNi42LDM5LjcsMTcuMSw0MCIvPgoJPC9nPgoJPGc+CgkJPHBhdGggY2xhc3M9InN0NCIgZD0iTTE5LjQsNDEuN0wxOS40LDQxLjdjMC40LTEuOCwyLjEtMywzLjktMi43YzEuOCwwLjMsMy4xLDIsMi44LDMuOGMtMC4zLDEuOC0yLDMuMS0zLjgsMi44bDAsMAoJCQljMC4yLDAuMywwLjMsMC43LDAuNCwxYzIuMiwwLjEsNC4xLTEuNSw0LjQtMy43YzAuNC0yLjQtMS4yLTQuNi0zLjYtNWMtMi4yLTAuMy00LjIsMS00LjgsMy4xQzE4LjksNDEuMiwxOS4yLDQxLjQsMTkuNCw0MS43Ii8+CgkJPHBhdGggY2xhc3M9InN0NCIgZD0iTTMyLjQsNDQuNEMzMiw0Ni4xLDMxLjIsNDcuNywzMCw0OWMtMS41LDEuNi0zLjQsMi42LTUuNCwzYzAuNiwzLDMuMyw1LjIsNi40LDUuMmMzLjYsMCw2LjUtMi45LDYuNS02LjUKCQkJQzM3LjUsNDcuNiwzNS4zLDQ1LDMyLjQsNDQuNCIvPgoJPC9nPgo8L2c+Cjwvc3ZnPgo=';
    }

    public getFormStack(): FormStack {
        const form = new Form(AUTHORIZATION_FORM, 'Authorization settings')
            .addField(new Field(FieldType.TEXT, API_KEY, ' Api key', undefined, true));

        return new FormStack().addForm(form);
    }

    public isAuthorized(applicationInstall: ApplicationInstall): boolean {
        const authorizationForm = applicationInstall.getSettings()[AUTHORIZATION_FORM];
        return authorizationForm?.[API_KEY];
    }

    public getRequestDto(
        dto: AProcessDto,
        applicationInstall: ApplicationInstall,
        method: HttpMethods,
        _url?: string,
        data?: unknown,
    ): RequestDto {
        const request = new RequestDto(`https://api.merk.cz/${_url}`, method, dto);
        const apiKey = applicationInstall.getSettings()[AUTHORIZATION_FORM][API_KEY];

        request.setHeaders({
            [CommonHeaders.CONTENT_TYPE]: JSON_TYPE,
            [CommonHeaders.ACCEPT]: JSON_TYPE,
            [CommonHeaders.AUTHORIZATION]: `Token ${apiKey}`,
        });

        if (data) {
            request.setJsonBody(data);
        }

        return request;
    }

}
