import { AUTHORIZATION_FORM } from '@orchesty/nodejs-sdk/dist/lib/Application/Base/AApplication';
import { ApplicationInstall } from '@orchesty/nodejs-sdk/dist/lib/Application/Database/ApplicationInstall';
import Field from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/Field';
import FieldType from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/FieldType';
import Form from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/Form';
import FormStack from '@orchesty/nodejs-sdk/dist/lib/Application/Model/Form/FormStack';
import { ABasicApplication } from '@orchesty/nodejs-sdk/dist/lib/Authorization/Type/Basic/ABasicApplication';
import RequestDto from '@orchesty/nodejs-sdk/dist/lib/Transport/Curl/RequestDto';
import { HttpMethods } from '@orchesty/nodejs-sdk/dist/lib/Transport/HttpMethods';
import AProcessDto from '@orchesty/nodejs-sdk/dist/lib/Utils/AProcessDto';
import { encode } from '@orchesty/nodejs-sdk/dist/lib/Utils/Base64';
import { CommonHeaders, JSON_TYPE } from '@orchesty/nodejs-sdk/dist/lib/Utils/Headers';

export const USERNAME = 'username';
export const PASSWORD = 'password';
export const NAME = 'green-house';

export default class GreenHouseApplication extends ABasicApplication {

    public getName(): string {
        return 'green-house';
    }

    public getPublicName(): string {
        return 'Greenhouse';
    }

    public getDescription(): string {
        return 'Leading hiring software for growing companies';
    }

    public getLogo(): string {
        return 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDI1LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9ImxheWVyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTAwIDEwMDsiIHhtbDpzcGFjZT0icHJlc2VydmUiPgo8c3R5bGUgdHlwZT0idGV4dC9jc3MiPgoJLnN0MHtmaWxsOiMyNEI0QTY7fQo8L3N0eWxlPgo8ZyBpZD0iVklBdjExXzJfIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNzcuNSAtMTM5LjgpIj4KCTxnIGlkPSJHcm91cF8yODI5OSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoNzcuNSAxMzkuOCkiPgoJCTxwYXRoIGlkPSJQYXRoXzE3NjAzIiBjbGFzcz0ic3QwIiBkPSJNNjUuNiw0Mi4xYy0yLjYsMC00LjgsMi4xLTQuOCw0LjdjMCwyLjYsMi4xLDQuOCw0LjcsNC44YzIuNiwwLDQuOC0yLjEsNC44LTQuNwoJCQlDNzAuNCw0NC4zLDY4LjMsNDIuMSw2NS42LDQyLjFDNjUuNyw0Mi4xLDY1LjYsNDIuMSw2NS42LDQyLjF6IE02NS42LDUwLjVjLTIsMC0zLjYtMS42LTMuNi0zLjdjMC0yLDEuNi0zLjYsMy43LTMuNgoJCQljMiwwLDMuNiwxLjYsMy42LDMuN0M2OS4zLDQ4LjksNjcuNiw1MC41LDY1LjYsNTAuNXoiLz4KCQk8cGF0aCBpZD0iUGF0aF8xNzYwNCIgY2xhc3M9InN0MCIgZD0iTTM2LjksNDYuOXYtMC4zYzAtMC44LTAuMi0xLjYtMC42LTIuM2MtMC40LTAuOC0xLjItMS41LTIuMS0xLjhjLTAuNi0wLjItMS4zLTAuMi0xLjktMC4yCgkJCWMtMC43LDAtMS40LDAuMy0xLjksMC43Yy0xLjMsMS0yLDIuNi0xLjgsNC4yYzAuMSwxLDAuNSwyLDEuMiwyLjhjMC43LDAuOCwxLjYsMS4yLDIuNiwxLjNjMC42LDAuMSwxLjEsMCwxLjctMC4xCgkJCWMwLjctMC4xLDEuMy0wLjQsMS44LTAuOGMwLjItMC4xLDAuNC0wLjMsMC41LTAuNWMwLjItMC4yLDAuMS0wLjUsMC0wLjZjMCwwLDAsMCwwLDBjLTAuMi0wLjItMC41LTAuMS0wLjcsMC4xCgkJCWMtMC4zLDAuMy0wLjcsMC42LTEuMSwwLjhjLTAuNiwwLjMtMS4zLDAuMy0yLDAuMmMtMC44LTAuMS0xLjUtMC40LTItMWMtMC41LTAuNi0wLjktMS40LTEtMi4yYzAtMC4xLDAtMC4yLDAtMC4zTDM2LjksNDYuOQoJCQlMMzYuOSw0Ni45eiBNMjkuNiw0NS43YzAuMi0wLjYsMC41LTEuMSwxLTEuNmMwLjUtMC40LDEuMS0wLjcsMS44LTAuOGMwLjQsMCwwLjksMCwxLjMsMC4xYzAuNywwLjIsMS4yLDAuNiwxLjYsMS4xCgkJCWMwLjMsMC40LDAuNCwwLjgsMC41LDEuM2MwLDAsMCwwLjEsMCwwLjFoLTYuM0MyOS42LDQ1LjksMjkuNiw0NS44LDI5LjYsNDUuN3oiLz4KCQk8cGF0aCBpZD0iUGF0aF8xNzYwNSIgY2xhc3M9InN0MCIgZD0iTTI1LjEsNDQuMmMtMC40LTAuOC0xLjEtMS40LTItMS42Yy0wLjYtMC4yLTEuMy0wLjItMS45LTAuMmMtMC41LDAtMS4xLDAuMi0xLjYsMC41CgkJCWMtMC44LDAuNC0xLjQsMS4xLTEuNywxLjljLTAuNCwwLjgtMC42LDEuOC0wLjUsMi43YzAuMSwwLjksMC40LDEuNywxLDIuNGMwLjcsMC45LDEuNywxLjUsMi45LDEuNmMwLjYsMC4xLDEuMSwwLDEuNy0wLjEKCQkJYzAuNy0wLjEsMS40LTAuNCwxLjktMC45YzAuMi0wLjEsMC4zLTAuMywwLjUtMC41YzAuMi0wLjIsMC4xLTAuNS0wLjEtMC43YzAsMCwwLDAsMCwwYy0wLjItMC4yLTAuNS0wLjEtMC43LDAuMQoJCQljLTAuMiwwLjMtMC42LDAuNS0wLjksMC43Yy0wLjcsMC4zLTEuNSwwLjQtMi4yLDAuM2MtMC44LTAuMS0xLjUtMC40LTItMWMtMC42LTAuNi0wLjktMS40LTEtMi4ydi0wLjJoNy40djAKCQkJQzI1LjksNDUuOSwyNS42LDQ1LDI1LjEsNDQuMnogTTE4LjUsNDUuOWMwLTAuMSwwLTAuMSwwLTAuMmMwLjEtMC42LDAuNC0xLjEsMC45LTEuNmMwLjQtMC41LDEtMC44LDEuNy0wLjkKCQkJYzAuNS0wLjEsMC45LTAuMSwxLjQsMGMwLjcsMC4yLDEuMywwLjYsMS43LDEuMmMwLjMsMC40LDAuNCwwLjgsMC41LDEuM3YwLjFMMTguNSw0NS45TDE4LjUsNDUuOXoiLz4KCQk8cGF0aCBpZD0iUGF0aF8xNzYwNiIgY2xhc3M9InN0MCIgZD0iTTk5LjIsNDkuM2MtMC4yLTAuMi0wLjUtMC4xLTAuNywwLjFjLTAuMiwwLjMtMC41LDAuNS0wLjksMC43Yy0wLjcsMC4zLTEuNSwwLjUtMi4yLDAuNAoJCQljLTAuOC0wLjEtMS42LTAuNS0yLjItMS4yYy0wLjUtMC41LTAuNy0xLjItMC44LTEuOWMwLTAuMSwwLTAuMywwLTAuNGg3LjRjMC0wLjIsMC0wLjUsMC0wLjhjLTAuMS0wLjgtMC4zLTEuNS0wLjgtMi4xCgkJCWMtMC41LTAuNy0xLjItMS4yLTItMS41Yy0wLjYtMC4yLTEuMi0wLjItMS45LTAuMWMtMC42LDAuMS0xLjIsMC4zLTEuNywwLjZjLTAuNywwLjUtMS4yLDEuMS0xLjYsMS45Yy0wLjMsMC44LTAuNSwxLjYtMC40LDIuNQoJCQljMC4xLDEsMC42LDIsMS4zLDIuN2MwLjcsMC43LDEuNiwxLjIsMi42LDEuM2MwLjUsMC4xLDEuMSwwLDEuNi0wLjFjMC43LTAuMSwxLjMtMC40LDEuOC0wLjhjMC4yLTAuMiwwLjQtMC4zLDAuNi0wLjUKCQkJQzk5LjUsNDkuNyw5OS40LDQ5LjQsOTkuMiw0OS4zeiBNOTIuNSw0NS45YzAuMi0wLjgsMC42LTEuNCwxLjItMS45YzAuNS0wLjQsMS0wLjYsMS42LTAuNmMwLjUsMCwxLDAsMS41LDAuMQoJCQljMC42LDAuMiwxLjEsMC42LDEuNCwxLjFjMC4zLDAuNCwwLjQsMC44LDAuNSwxLjNWNDZMOTIuNSw0NS45QzkyLjUsNDUuOSw5Mi41LDQ1LjksOTIuNSw0NS45eiIvPgoJCTxwYXRoIGlkPSJQYXRoXzE3NjA3IiBjbGFzcz0ic3QwIiBkPSJNNTcuOSw0NS43djQuOWMwLDAuMSwwLDAuMSwwLDAuMmMtMC4xLDAuMi0wLjMsMC40LTAuNSwwLjRjLTAuMiwwLTAuNC0wLjItMC40LTAuNXYtNC43CgkJCWMwLTAuNCwwLTAuOS0wLjItMS4zYy0wLjItMC44LTAuOS0xLjMtMS43LTEuNGMtMC41LTAuMS0xLjEsMC0xLjYsMC4yYy0wLjgsMC4zLTEuNCwxLTEuNiwxLjhjMCwwLjEsMCwwLjEsMCwwLjJ2NS4yCgkJCWMwLDAuMi0wLjIsMC41LTAuNCwwLjVoMGMtMC4yLDAtMC41LTAuMi0wLjUtMC40VjM5LjJjMC0wLjIsMC4zLTAuNCwwLjUtMC40YzAuMiwwLDAuNCwwLjIsMC41LDAuNHY0LjRoMGMwLDAsMCwwLDAtMC4xCgkJCWMwLjYtMC43LDEuNC0xLjEsMi4zLTEuMmMwLjUtMC4xLDEuMSwwLDEuNiwwLjFjMS4xLDAuMywxLjksMS4yLDIuMSwyLjNDNTcuOCw0NS4xLDU3LjksNDUuNCw1Ny45LDQ1Ljd6Ii8+CgkJPHBhdGggaWQ9IlBhdGhfMTc2MDgiIGNsYXNzPSJzdDAiIGQ9Ik01LjEsNTEuNGMtMi43LDAtNC45LDIuMS00LjksNC44YzAsMi43LDIuMSw0LjksNC44LDQuOWMyLjcsMCw0LjktMi4xLDQuOS00LjgKCQkJYzAsMCwwLDAsMC0wLjFDMTAsNTMuNiw3LjgsNTEuNSw1LjEsNTEuNEM1LjEsNTEuNCw1LjEsNTEuNCw1LjEsNTEuNHogTTUsNjAuM2MtMi4yLDAtNC0xLjgtMy45LTQuMWMwLTIuMiwxLjgtNCw0LjEtMy45CgkJCWMyLjIsMCwzLjksMS44LDMuOSw0QzkuMSw1OC42LDcuMyw2MC4zLDUsNjAuM3oiLz4KCQk8cGF0aCBpZD0iUGF0aF8xNzYwOSIgY2xhc3M9InN0MCIgZD0iTTQ3LDUwLjdjMCwwLjItMC4xLDAuNS0wLjQsMC41Yy0wLjMsMC0wLjUtMC4xLTAuNi0wLjRjMCwwLDAsMCwwLDB2LTQuNwoJCQljMC0wLjQsMC0wLjktMC4yLTEuM2MtMC4xLTAuNi0wLjUtMS0xLTEuM2MtMC4yLTAuMS0wLjUtMC4yLTAuOC0wLjJjLTAuNS0wLjEtMSwwLTEuNSwwLjJjLTAuOCwwLjMtMS40LDEtMS43LDEuOQoJCQljMCwwLjEsMCwwLjEsMCwwLjJ2NS4zYzAsMC4yLTAuMiwwLjQtMC41LDAuNGMtMC4yLDAtMC41LTAuMi0wLjUtMC40djB2LTcuOWMwLTAuMywwLjItMC41LDAuNS0wLjVzMC41LDAuMiwwLjUsMC41YzAsMCwwLDAsMCwwCgkJCXYwLjdsMC4xLTAuMWMwLjYtMC43LDEuNC0xLjEsMi4zLTEuMmMwLjYtMC4xLDEuMiwwLDEuNywwLjJjMSwwLjMsMS44LDEuMSwyLDIuMmMwLjEsMC4zLDAuMSwwLjYsMC4xLDAuOUM0Nyw0Ny40LDQ3LDQ5LDQ3LDUwLjd6CgkJCSIvPgoJCTxwYXRoIGlkPSJQYXRoXzE3NjEwIiBjbGFzcz0ic3QwIiBkPSJNODAuNSw1MC43djAuMmMwLDAuMi0wLjMsMC40LTAuNSwwLjRjLTAuMiwwLTAuNC0wLjItMC41LTAuNHYtMC43aDBjMCwwLTAuMSwwLjEtMC4xLDAuMQoJCQljLTAuNSwwLjctMS4zLDEuMS0yLjIsMS4yYy0wLjYsMC4xLTEuMiwwLjEtMS43LTAuMWMtMS4xLTAuMy0xLjktMS4xLTIuMS0yLjJjLTAuMS0wLjMtMC4xLTAuNy0wLjEtMXYtNWMwLTAuMiwwLjEtMC4zLDAuMi0wLjUKCQkJYzAuMS0wLjEsMC4zLTAuMSwwLjUtMC4xYzAuMiwwLjEsMC4zLDAuMiwwLjMsMC40djQuOGMwLDAuNCwwLjEsMC45LDAuMiwxLjNjMC4yLDAuNywwLjksMS4zLDEuNywxLjRjMC42LDAuMSwxLjIsMCwxLjctMC4yCgkJCWMwLjgtMC4zLDEuNC0xLDEuNi0xLjljMC0wLjEsMC0wLjEsMC0wLjJ2LTUuM2MwLjEtMC4yLDAuMy0wLjQsMC41LTAuNGMwLjIsMCwwLjQsMC4yLDAuNCwwLjVWNDNDODAuNSw0NS42LDgwLjUsNDguMSw4MC41LDUwLjd6CgkJCSIvPgoJCTxwYXRoIGlkPSJQYXRoXzE3NjExIiBjbGFzcz0ic3QwIiBkPSJNNC4yLDQyLjVjLTIuMiwwLTQsMS44LTQsNHMxLjgsNCw0LDRzNC0xLjgsNC00bDAsMEM4LjIsNDQuMyw2LjQsNDIuNSw0LjIsNDIuNXogTTQuMiw0OS42CgkJCWMtMS43LDAtMy4xLTEuNC0zLjEtMy4yYzAtMS43LDEuNC0zLjEsMy4yLTMuMWMxLjcsMCwzLjEsMS40LDMuMSwzLjJsMCwwQzcuMyw0OC4yLDUuOSw0OS42LDQuMiw0OS42TDQuMiw0OS42eiIvPgoJCTxwYXRoIGlkPSJQYXRoXzE3NjEyIiBjbGFzcz0ic3QwIiBkPSJNODguNSw1MC45Yy0wLjQsMC4zLTAuOSwwLjQtMS4zLDAuNWMtMC4yLDAtMC40LDAtMC41LDAuMWMtMC43LDAtMS40LTAuMS0yLTAuNQoJCQljLTAuNC0wLjMtMC44LTAuNi0xLTEuMWMtMC4xLTAuMS0wLjEtMC4zLTAuMS0wLjVjMC4xLTAuMywwLjMtMC40LDAuNi0wLjRjMC4xLDAsMC4xLDAsMC4yLDAuMWMwLjEsMCwwLjIsMC4xLDAuMiwwLjIKCQkJYzAuMywwLjYsMSwxLjEsMS43LDEuMWMwLjUsMC4xLDEsMCwxLjQtMC4zYzAuMS0wLjEsMC4zLTAuMiwwLjQtMC4zYzAuNC0wLjQsMC41LTAuOSwwLjMtMS40Yy0wLjEtMC4yLTAuMy0wLjUtMC41LTAuNgoJCQljLTAuMy0wLjItMC43LTAuNC0xLjEtMC41Yy0wLjMtMC4xLTAuNi0wLjItMC45LTAuM2MtMC41LTAuMi0wLjktMC40LTEuMy0wLjdjLTAuNC0wLjQtMC43LTAuOS0wLjctMS41YzAtMC4zLDAtMC43LDAuMS0xCgkJCWMwLjItMC41LDAuNi0xLDEuMi0xLjJjMC41LTAuMiwxLjEtMC4zLDEuNi0wLjJjMC41LDAsMC45LDAuMiwxLjMsMC41YzAuNCwwLjMsMC43LDAuNiwwLjksMWMwLjEsMC4xLDAuMSwwLjIsMCwwLjQKCQkJYzAsMC4yLTAuMiwwLjMtMC40LDAuNGMtMC4yLDAtMC40LTAuMS0wLjUtMC4yYzAsMCwwLTAuMS0wLjEtMC4xYy0wLjItMC41LTAuNy0wLjgtMS4zLTAuOWMtMC40LDAtMC43LDAtMS4xLDAuMQoJCQljLTAuNiwwLjItMC45LDAuOC0wLjcsMS40YzAsMCwwLDAsMCwwYzAuMSwwLjMsMC4yLDAuNiwwLjUsMC44YzAuMywwLjIsMC42LDAuNCwxLDAuNWMwLjMsMC4xLDAuNiwwLjIsMC45LDAuMwoJCQljMC40LDAuMSwwLjgsMC4zLDEuMiwwLjZjMC41LDAuMywwLjgsMC45LDAuOSwxLjVDODkuNiw0OS41LDg5LjIsNTAuNCw4OC41LDUwLjl6Ii8+CgkJPHBhdGggaWQ9IlBhdGhfMTc2MTMiIGNsYXNzPSJzdDAiIGQ9Ik0xNiw0My4xYy0wLjEsMC4zLTAuMywwLjQtMC42LDAuNGMtMC4zLDAtMC41LTAuMS0wLjgtMC4xYy0wLjksMC4xLTEuNiwwLjYtMi4xLDEuMwoJCQljLTAuMiwwLjMtMC4yLDAuNi0wLjIsMC45djVjMCwwLjEsMCwwLjIsMCwwLjJjLTAuMSwwLjItMC4zLDAuMy0wLjUsMC4zYy0wLjIsMC0wLjQtMC4yLTAuNS0wLjRWNDNjMC0wLjEsMC0wLjIsMC0wLjIKCQkJYzAuMS0wLjIsMC4zLTAuNCwwLjUtMC4zYzAuMiwwLDAuNCwwLjIsMC40LDAuNXYwLjhoMGwwLjEtMC4xYzAuNC0wLjUsMS4xLTAuOSwxLjgtMS4xYzAuNS0wLjEsMS0wLjEsMS40LDAKCQkJQzE1LjksNDIuNiwxNiw0Mi44LDE2LDQzLjFMMTYsNDMuMXoiLz4KCQk8cGF0aCBpZD0iUGF0aF8xNzYxNCIgY2xhc3M9InN0MCIgZD0iTTguMyw0MS40YzAsMC41LTAuNCwwLjgtMC44LDAuOHMtMC44LTAuNC0wLjgtMC44YzAtMC41LDAuNC0wLjgsMC44LTAuOAoJCQlDNy45LDQwLjYsOC4zLDQwLjksOC4zLDQxLjRDOC4zLDQxLjQsOC4zLDQxLjQsOC4zLDQxLjR6Ii8+Cgk8L2c+CjwvZz4KPC9zdmc+Cg==';
    }

    public getFormStack(): FormStack {
        const form = new Form(AUTHORIZATION_FORM, 'Authorization settings')
            .addField(new Field(FieldType.TEXT, USERNAME, ' username', undefined, true))
            .addField(new Field(FieldType.PASSWORD, PASSWORD, ' password', undefined, true));

        return new FormStack().addForm(form);
    }

    public isAuthorized(applicationInstall: ApplicationInstall): boolean {
        const authorizationForm = applicationInstall.getSettings()[AUTHORIZATION_FORM];
        return authorizationForm?.[USERNAME] && authorizationForm?.[PASSWORD];
    }

    public getRequestDto(
        dto: AProcessDto,
        applicationInstall: ApplicationInstall,
        method: HttpMethods,
        _url?: string,
        data?: unknown,
    ): RequestDto {
        const request = new RequestDto(`https://harvest.greenhouse.io/v1/${_url}`, method, dto);
        const username = applicationInstall.getSettings()[AUTHORIZATION_FORM][USERNAME];
        const password = applicationInstall.getSettings()[AUTHORIZATION_FORM][PASSWORD];
        request.setHeaders({
            [CommonHeaders.CONTENT_TYPE]: JSON_TYPE,
            [CommonHeaders.ACCEPT]: JSON_TYPE,
            [CommonHeaders.AUTHORIZATION]: encode(`${username}:${password}`),
        });

        if (data) {
            request.setJsonBody(data);
        }

        return request;
    }

}
